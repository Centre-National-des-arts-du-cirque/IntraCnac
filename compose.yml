version: "3.4"

services:
    php:
        image: intracnac-php:latest
        restart: unless-stopped
        environment:
            # Run "composer require symfony/orm-pack" to install and configure Doctrine ORM
            DATABASE_URL: postgresql://${POSTGRES_USER:-app}:${POSTGRES_PASSWORD:-!ChangeMe!}@database:5432/${POSTGRES_DB:-app}?serverVersion=${POSTGRES_VERSION:-15}&charset=${POSTGRES_CHARSET:-utf8}
            # The two next lines can be removed after initial installation
            SYMFONY_VERSION: ${SYMFONY_VERSION:-}
            STABILITY: ${STABILITY:-stable}
        networks:
            caddy:
        labels:
            caddy: localhost
            caddy.reverse_proxy: "{{upstreams 81}}"

    adminer:
        image: michalhosna/adminer
        ports:
            - 8081:8080
        environment:
            ADMINER_DB: support
            ADMINER_DRIVER: pgsql
            ADMINER_PASSWORD: ${POSTGRES_PASSWORD:-!ChangeMe!}
            ADMINER_SERVER: database
            ADMINER_USERNAME: admin
            ADMINER_AUTOLOGIN: 1
            ADMINER_NAME: supportWebsite

    database:
        image: postgres:${POSTGRES_VERSION:-15}-alpine
        environment:
            POSTGRES_DB: ${POSTGRES_DB:-app}
            # You should definitely change the password in production
            POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-!ChangeMe!}
            POSTGRES_USER: ${POSTGRES_USER:-app}
        volumes:
            - database_data:/var/lib/postgresql/data:rw
        ports:
            - 5432:5432
# Mercure is installed as a Caddy module, prevent the Flex recipe from installing another service
###> symfony/mercure-bundle ###
###< symfony/mercure-bundle ###
networks:
    caddy:
        external: true
volumes:
    database_data:
###> symfony/mercure-bundle ###
###< symfony/mercure-bundle ###
